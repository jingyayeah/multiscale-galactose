compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
f_maxima = getMaximaFromDilutionData(gor1983)
head(gor1983$RBC)
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
# Create the boxplots with the mean curves
createFullPlot <- function (maxtime, ccolors, time.offset, scale_f) {
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_MultipleIndicator_with_experimental_data.png", sep=""),
width = 1400, height = 1400, units = "px", bg = "white",  res = 150)
}
par(mfrow=c(2,1))
boxplot(maxtime, col=ccolors, horizontal=T,  ylim=c(0,20),
xaxt="n", # suppress the default x axis
yaxt="n", # suppress the default y axis
bty="n") # suppress the plotting frame
# Plot curves
plot(numeric(0), numeric(0), xlim=c(0,20), ylim=c(0,20),
xlab="time [s]", ylab="10^3 x outflow fraction/ml")
for (kc in seq(1, length(compounds)) ){
name = paste("PV__", compounds[kc], sep="")
data <- preprocess.mat[[name]]  #+1E-06 fix for logscale
time <- as.numeric(rownames(data))-time.offset
# plot the mean and std for time courses
rmean <- rowMeans(data)
rstd <- rowSds(data)
lines(time, rmean*f_scale, col=ccolors[kc], lwd=4)
lines(time, (rmean+rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
lines(time, (rmean-rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
}
## Add the experimental data from Goresky1983 & 1973 ##
plotDilutionData(gor1983, compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="A",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="B",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="C",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
legend("topright",  legend = expcompounds, fill=expcolors)
par(mfrow=c(1,1))
if (create_plot_files){
dev.off()
}
}
f_maxima = getMaximaFromDilutionData(gor1983)
f_maxima = getDilutionDataMaxima(gor1983)
f_maxima = getDilutionDataMaxima(gor1983)
f_maxima = getDilutionDataMaxima(gor1983, compounds)
f_maxima = getDilutionDataMaxima(gor1983, compounds)
f_maxima = getDilutionDataMaxima(gor1983, expcompounds)
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
f_maxima = getDilutionDataMaxima(gor1983, expcompounds)
f_maxima = getDilutionDataMaxima(gor1983, expcompounds)
print(gor1983)
devtools::load_all("~/multiscale-galactose/R/MultiscaleAnalysis")
print(gor1983)
f_maxima = getDilutionDataMaxima(gor1983, expcompounds)
expcompounds
gor1983
m1 = max(gor1983$RBC)
m1 = max(gor1983$outflow)
m1
# Create the boxplots with the mean curves
createFullPlot <- function (maxtime, ccolors, time.offset, scale_f) {
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_MultipleIndicator_with_experimental_data.png", sep=""),
width = 1400, height = 1400, units = "px", bg = "white",  res = 150)
}
par(mfrow=c(2,1))
boxplot(maxtime, col=ccolors, horizontal=T,  ylim=c(0,20),
xaxt="n", # suppress the default x axis
yaxt="n", # suppress the default y axis
bty="n") # suppress the plotting frame
# Plot curves
plot(numeric(0), numeric(0), xlim=c(0,20), ylim=c(0,20),
xlab="time [s]", ylab="10^3 x outflow fraction/ml")
for (kc in seq(1, length(compounds)) ){
name = paste("PV__", compounds[kc], sep="")
data <- preprocess.mat[[name]]  #+1E-06 fix for logscale
time <- as.numeric(rownames(data))-time.offset
# plot the mean and std for time courses
rmean <- rowMeans(data)
scale_f <- scale_f/max(rowMeans);
rstd <- rowSds(data)
lines(time, rmean*f_scale, col=ccolors[kc], lwd=4)
lines(time, (rmean+rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
lines(time, (rmean-rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
}
## Add the experimental data from Goresky1983 & 1973 ##
plotDilutionData(gor1983, compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="A",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="B",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="C",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
legend("topright",  legend = expcompounds, fill=expcolors)
par(mfrow=c(1,1))
if (create_plot_files){
dev.off()
}
}
createBoxPlot <- function (maxtime, ccolors, time.offset) {
# Boxplot of the maxtimes
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_Boxplot_MaxTimes", sep=""),
width = 1000, height = 1000, units = "px", bg = "white",  res = 150)
}
boxplot(maxtime-time.offset, col=ccolors, horizontal=T, xlab="time [s]")
if (create_plot_files){
dev.off()
}
}
# create the plots
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",])
m3 = max(gor1973[gor1973$condition=="B",])
m4 = max(gor1973[gor1973$condition=="C",])
scale_f = (m1+m2+m3+m4)/4;
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",])
m3 = max(gor1973[gor1973$condition=="B",])
m4 = max(gor1973[gor1973$condition=="C",])
scale_f = (m1+m2+m3+m4)/4;
m1 = max(gor1983$outflow)
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",outflow])
m3 = max(gor1973[gor1973$condition=="B",outflow])
m4 = max(gor1973[gor1973$condition=="C",outflow])
scale_f = (m1+m2+m3+m4)/4;
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
scale_f
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
scale_f
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
# Create the boxplots with the mean curves
createFullPlot <- function (maxtime, ccolors, time.offset, scale_f) {
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_MultipleIndicator_with_experimental_data.png", sep=""),
width = 1400, height = 1400, units = "px", bg = "white",  res = 150)
}
par(mfrow=c(2,1))
boxplot(maxtime, col=ccolors, horizontal=T,  ylim=c(0,20),
xaxt="n", # suppress the default x axis
yaxt="n", # suppress the default y axis
bty="n") # suppress the plotting frame
# Plot curves
plot(numeric(0), numeric(0), xlim=c(0,20), ylim=c(0,20),
xlab="time [s]", ylab="10^3 x outflow fraction/ml")
for (kc in seq(1, length(compounds)) ){
name = paste("PV__", compounds[kc], sep="")
data <- preprocess.mat[[name]]  #+1E-06 fix for logscale
time <- as.numeric(rownames(data))-time.offset
# plot the mean and std for time courses
rmean <- rowMeans(data)
scale_f <- scale_f/max(rmean);
rstd <- rowSds(data)
lines(time, rmean*f_scale, col=ccolors[kc], lwd=4)
lines(time, (rmean+rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
lines(time, (rmean-rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
}
## Add the experimental data from Goresky1983 & 1973 ##
plotDilutionData(gor1983, compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="A",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="B",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="C",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
legend("topright",  legend = expcompounds, fill=expcolors)
par(mfrow=c(1,1))
if (create_plot_files){
dev.off()
}
}
createBoxPlot <- function (maxtime, ccolors, time.offset) {
# Boxplot of the maxtimes
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_Boxplot_MaxTimes", sep=""),
width = 1000, height = 1000, units = "px", bg = "white",  res = 150)
}
boxplot(maxtime-time.offset, col=ccolors, horizontal=T, xlab="time [s]")
if (create_plot_files){
dev.off()
}
}
# create the plots
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
scale_f
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
# Create the boxplots with the mean curves
createFullPlot <- function (maxtime, ccolors, time.offset, scale_f) {
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_MultipleIndicator_with_experimental_data.png", sep=""),
width = 1400, height = 1400, units = "px", bg = "white",  res = 150)
}
par(mfrow=c(2,1))
boxplot(maxtime, col=ccolors, horizontal=T,  ylim=c(0,20),
xaxt="n", # suppress the default x axis
yaxt="n", # suppress the default y axis
bty="n") # suppress the plotting frame
# Plot curves
plot(numeric(0), numeric(0), xlim=c(0,20), ylim=c(0,20),
xlab="time [s]", ylab="10^3 x outflow fraction/ml")
for (kc in seq(1, length(compounds)) ){
name = paste("PV__", compounds[kc], sep="")
data <- preprocess.mat[[name]]  #+1E-06 fix for logscale
time <- as.numeric(rownames(data))-time.offset
# plot the mean and std for time courses
rmean <- rowMeans(data)
f_scale <- scale_f/max(rmean);
rstd <- rowSds(data)
lines(time, rmean*f_scale, col=ccolors[kc], lwd=4)
lines(time, (rmean+rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
lines(time, (rmean-rstd)*f_scale, col=ccolors[kc], lwd=1, lty=2)
}
## Add the experimental data from Goresky1983 & 1973 ##
plotDilutionData(gor1983, compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="A",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="B",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="C",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
legend("topright",  legend = expcompounds, fill=expcolors)
par(mfrow=c(1,1))
if (create_plot_files){
dev.off()
}
}
createBoxPlot <- function (maxtime, ccolors, time.offset) {
# Boxplot of the maxtimes
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_Boxplot_MaxTimes", sep=""),
width = 1000, height = 1000, units = "px", bg = "white",  res = 150)
}
boxplot(maxtime-time.offset, col=ccolors, horizontal=T, xlab="time [s]")
if (create_plot_files){
dev.off()
}
}
# create the plots
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
scale_f
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
# Create the boxplots with the mean curves
createFullPlot <- function (maxtime, ccolors, time.offset, scale_f) {
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_MultipleIndicator_with_experimental_data.png", sep=""),
width = 1400, height = 1400, units = "px", bg = "white",  res = 150)
}
par(mfrow=c(2,1))
boxplot(maxtime, col=ccolors, horizontal=T,  ylim=c(0,20),
xaxt="n", # suppress the default x axis
yaxt="n", # suppress the default y axis
bty="n") # suppress the plotting frame
# Plot curves
plot(numeric(0), numeric(0), xlim=c(0,20), ylim=c(0,20),
xlab="time [s]", ylab="10^3 x outflow fraction/ml")
# plot the mean and std for time courses
for (kc in seq(1, length(compounds)) ){
name = paste("PV__", compounds[kc], sep="")
data <- preprocess.mat[[name]]  #+1E-06 fix for logscale
time <- as.numeric(rownames(data))-time.offset
# plot the mean and std for time courses
rmean <- rowMeans(data)
rstd <- rowSds(data)
lines(time, rmean*scale_f, col=ccolors[kc], lwd=4)
lines(time, (rmean+rstd)*scale_f, col=ccolors[kc], lwd=1, lty=2)
lines(time, (rmean-rstd)*scale_f, col=ccolors[kc], lwd=1, lty=2)
}
## Add the experimental data from Goresky1983 & 1973 ##
plotDilutionData(gor1983, compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="A",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="B",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
plotDilutionData(gor1973[gor1973$condition=="C",], compounds=expcompounds, ccolors=expcolors, correctTime=TRUE)
legend("topright",  legend = expcompounds, fill=expcolors)
par(mfrow=c(1,1))
if (create_plot_files){
dev.off()
}
}
createBoxPlot <- function (maxtime, ccolors, time.offset) {
# Boxplot of the maxtimes
if (create_plot_files){
png(filename=paste(ma.settings$dir.results, '/', task, "_Boxplot_MaxTimes", sep=""),
width = 1000, height = 1000, units = "px", bg = "white",  res = 150)
}
boxplot(maxtime-time.offset, col=ccolors, horizontal=T, xlab="time [s]")
if (create_plot_files){
dev.off()
}
}
# create the plots
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
data <-   #+1E-06 fix for logscale
rmean_rbc <- rowMeans(preprocess.mat[['PV__RBC']])
scale_f <- scale_f/max(rmean_rbc);
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
rmean_rbc <- rowMeans(preprocess.mat[['PV__RBC']])
head(preprocess.mat)
head(preprocess.mat[['PV_RBC']])
head(preprocess.mat[['PV__rbcM']])
rmean_rbc <- rowMeans(preprocess.mat[['PV__rbcM']])
scale_f <- scale_f/max(rmean_rbc);
scale_f
# create the plots
create_plot_files = TRUE
compounds = c('rbcM', 'alb', 'suc', 'h2oM')
ccolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
time.offset = 10.0  # peak start of input
expcompounds = c('RBC', 'albumin', 'sucrose', 'water')
expcolors = c('red', 'darkgreen', 'darkorange', 'darkblue')
gor1973 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1973_Fig1.csv"), sep="\t")
summary(gor1973)
# Units: time [s], compound: 1000*outflow fraction/ml
gor1983 <- read.csv(file.path(ma.settings$dir.expdata, "dilution_indicator", "Goresky1983_Fig1.csv"), sep="\t")
summary(gor1983)
m1 = max(gor1983$outflow)
m2 = max(gor1973[gor1973$condition=="A",'outflow'])
m3 = max(gor1973[gor1973$condition=="B",'outflow'])
m4 = max(gor1973[gor1973$condition=="C",'outflow'])
scale_f = (m1+m2+m3+m4)/4;
data <-   #+1E-06 fix for logscale
rmean_rbc <- rowMeans(preprocess.mat[['PV__rbcM']])
scale_f <- scale_f/max(rmean_rbc);
scale_f
for (kt in seq(Ntask)){
task <- tasks[kt]
peak <- peaks[kt]
modelId <- paste('MultipleIndicator_', peak, '_', version, '_Nc20_Nf1', sep='')
parsfile <- file.path(ma.settings$dir.results, sname,
paste(task, '_', modelId, '_parameters.csv', sep=""))
# Load the data
load(file=outfileFromParsFile(parsfile))
# Calculate the max times
maxtime <- calculateMaxTimes(preprocess.mat, compounds, time.offset)
print(summary(maxtime))
createFullPlot(maxtime, ccolors, time.offset=time.offset, scale_f)
# createBoxPlot(maxtime, ccolors, time.offset=time.offset)
}
#' Corrects the dilution times, so that zero timepoint is first datapoint.
#'
#' @param data data to be corrected
#' @return new data with corrected times
#' @export
correctDilutionTimes <- function(data){
dnew <- data;
# TODO: properly extrapolate to zero
dnew$time <- dnew$time - min(data$time) + 1.0
dnew
}
